# Alertmanager enabled + pinned to EC2 nodes
alertmanager:
  enabled: true
  alertmanagerSpec:
    nodeSelector:
      eks.amazonaws.com/compute-type: "ec2"     # Fargate can't mount PVCs
    receivers:
      - name: default
        email_configs:
          - to: "devops979@gmail.com"
  configMaps: []                                 # rules shipped separately

# Prometheus server pinned to EC2 nodes (for local storage)
prometheus:
  prometheusSpec:
    nodeSelector:
      eks.amazonaws.com/compute-type: "ec2"

# Node exporter DaemonSet — run **only** on EC2
nodeExporter:
  tolerations:
    - key: "node-role.kubernetes.io/control-plane"
      operator: "Exists"
      effect: "NoSchedule"
  nodeSelector:
    eks.amazonaws.com/compute-type: "ec2"

# ServiceMonitors – scrape your app pods on Fargate
serviceMonitors:
  - name: backend-fargate
    selector:
      matchLabels:
        app: backend
    namespaceSelector:
      matchNames: [backend]
    endpoints:
      - port: http           # must match Service port name
        path: /metrics
        interval: 30s

  - name: frontend-fargate
    selector:
      matchLabels:
        app: frontend
    namespaceSelector:
      matchNames: [frontend]
    endpoints:
      - port: http
        path: /metrics
        interval: 30s
